@page "/productionPlans"
@using Append.Blazor.Printing
@inject NavigationManager Navigation
@inject IPrintingService PrintingService

<ProductionPlansCalendar @ref="productionPlansCalendar" OnItemClick="HandleItemClick" OnMonthChanged="UpdateMaxDaysInMonth"/>

<div class="input-group" style="width: 15%">
    <input type="number" class="form-control" aria-describedby="wydrukuj" min="1" max="@MaxDaysInMonth" @bind="SelectedDay">
    <button class="btn btn-outline-secondary" type="button" id="wydrukuj" @onclick="PrintProductionPlan">Wydrukuj</button>
</div>

@code {
    private ProductionPlansCalendar productionPlansCalendar = new ProductionPlansCalendar();
    private int SelectedDay { get; set; } = 1;

    private int MaxDaysInMonth => DateTime.DaysInMonth(productionPlansCalendar.CurrentDate.Year, productionPlansCalendar.CurrentDate.Month);

    private void UpdateMaxDaysInMonth()
    {
        StateHasChanged();
    }

    private void HandleItemClick((DateOnly date, int change, int team) item)
    {
        var (date, change, team) = item;
        Navigation.NavigateTo($"/productionPlan?date={date}&change={change}&team={team}");
    }

    private void PrintProductionPlan()
    {
        var selectedDate = new DateOnly(productionPlansCalendar.CurrentDate.Year, productionPlansCalendar.CurrentDate.Month, SelectedDay).ToString("yyyy-MM-dd");

        var url = $"http://localhost:5132/api/productionPlan/productionPlan-{selectedDate}.pdf";
        PrintingService.Print(url);
    }

}